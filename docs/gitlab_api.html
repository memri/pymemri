---

title: - Downloading & Uploading functions for package registry


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/gitlab_api.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/gitlab_api.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_git_repo" class="doc_header"><code>find_git_repo</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L33" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_git_repo</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_registry_api_key" class="doc_header"><code>get_registry_api_key</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L49" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_registry_api_key</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="upload_in_chunks" class="doc_header"><code>class</code> <code>upload_in_chunks</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L66" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>upload_in_chunks</code>(<strong><code>filename</code></strong>, <strong><code>chunksize</code></strong>=<em><code>16384</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="IterableToFileAdapter" class="doc_header"><code>class</code> <code>IterableToFileAdapter</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L98" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>IterableToFileAdapter</code>(<strong><code>iterable</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="write_file_to_package_registry" class="doc_header"><code>write_file_to_package_registry</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L110" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>write_file_to_package_registry</code>(<strong><code>project_id</code></strong>, <strong><code>file_path</code></strong>, <strong><code>api_key</code></strong>, <strong><code>package_name</code></strong>, <strong><code>version</code></strong>=<em><code>'0.0.1'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="project_id_from_name" class="doc_header"><code>project_id_from_name</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L126" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>project_id_from_name</code>(<strong><code>project_name</code></strong>, <strong><code>api_key</code></strong>, <strong><code>job_token</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_project_id_from_project_path_unsafe" class="doc_header"><code>get_project_id_from_project_path_unsafe</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L145" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_project_id_from_project_path_unsafe</code>(<strong><code>project_path</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download_package_file" class="doc_header"><code>download_package_file</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L155" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download_package_file</code>(<strong><code>filename</code></strong>, <strong><code>project_path</code></strong>, <strong><code>package_name</code></strong>, <strong><code>out_dir</code></strong>=<em><code>None</code></em>, <strong><code>package_version</code></strong>=<em><code>'0.0.1'</code></em>, <strong><code>download_if_exists</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># todo: cleanup old package files during testing</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;config.json&quot;</span>
<span class="n">out_file</span> <span class="o">=</span> <span class="n">download_package_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;memri/finetuning-example&quot;</span><span class="p">,</span> <span class="s2">&quot;plugin-model-package&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>/Users/koen/.memri/projects/finetuning-example/config.json
/Users/koen/.memri/projects/finetuning-example/config.json already exists, and `download_if_exists`==False, using cached version
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_repo" class="doc_header"><code>create_repo</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L183" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_repo</code>(<strong><code>repo_name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_current_username" class="doc_header"><code>get_current_username</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L194" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_current_username</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">delete_project</span><span class="p">(</span><span class="n">path_or_id</span><span class="p">):</span>
    <span class="n">url_escape_id</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">path_or_id</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">GITLAB_API_BASE_URL</span><span class="si">}</span><span class="s2">/projects/</span><span class="si">{</span><span class="n">url_escape_id</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="n">get_registry_api_key</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;PRIVATE-TOKEN&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">202</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed to delete repo:</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;deleted project </span><span class="si">{</span><span class="n">path_or_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="commit_file" class="doc_header"><code>commit_file</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L205" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>commit_file</code>(<strong><code>project_name</code></strong>, <strong><code>path_in2out</code></strong>, <strong><code>branch</code></strong>=<em><code>'main'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rm_tree" class="doc_header"><code>rm_tree</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L232" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rm_tree</code>(<strong><code>pth</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="write_files_to_git" class="doc_header"><code>write_files_to_git</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L246" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>write_files_to_git</code>(<strong><code>repo</code></strong>, <strong><code>target_dir</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_new_project" class="doc_header"><code>create_new_project</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/gitlab_api.py#L255" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_new_project</code>(<strong><code>project_name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">repo</span> <span class="o">=</span> <span class="s2">&quot;test12345612345&quot;</span>
<span class="n">create_repo</span><span class="p">(</span><span class="n">repo</span><span class="p">)</span>
<span class="c1"># delete_project(f&quot;{get_current_username()}/{repo}&quot;)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>created project test12345612345
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">create_new_project</span><span class="p">(</span><span class="n">repo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Created `Test12345612345` using the classifier_plugin template.
committed files [&#39;/tmp/test/test12345612345/Dockerfile&#39;, &#39;/tmp/test/test12345612345/metadata.json&#39;, &#39;/tmp/test/test12345612345/README.md&#39;, &#39;/tmp/test/test12345612345/setup.py&#39;, &#39;/tmp/test/test12345612345/.gitignore&#39;, &#39;/tmp/test/test12345612345/setup.cfg&#39;, &#39;/tmp/test/test12345612345/.gitlab-ci.yml&#39;, &#39;/tmp/test/test12345612345/LICENSE.txt&#39;, &#39;/tmp/test/test12345612345/tools/preload.py&#39;, &#39;/tmp/test/test12345612345/test12345612345/model.py&#39;, &#39;/tmp/test/test12345612345/test12345612345/utils.py&#39;, &#39;/tmp/test/test12345612345/test12345612345/plugin.py&#39;, &#39;/tmp/test/test12345612345/test12345612345/schema.py&#39;, &#39;/tmp/test/test12345612345/tests/test_plugin.py&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">delete_project</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">get_current_username</span><span class="p">()</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>deleted project koenvanderveen/test12345612345
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

