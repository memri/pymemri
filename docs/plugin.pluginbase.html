---

title: Plugins


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/plugin.pluginbase.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/plugin.pluginbase.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>PluginBase is the plugin class that the simplest plugin inherits.</p>
<p>Inheriting class should implement:</p>
<ul>
<li>run()           that implements the logic of the plugin</li>
<li>add_to_schema() for plugin specific item types</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Creating-a-plugin">Creating a plugin<a class="anchor-link" href="#Creating-a-plugin"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The memri <a href="https://gitlab.memri.io/memri/pod">pod</a> uses a plugin system to add features to the backend memri backend. Plugins can import your data (importers), change your data (indexers), or call other serivces. Users can define their own plugins to add new behaviour to their memri app. Let's use the following plugin as an example of how we can start plugins.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyItem</span><span class="p">(</span><span class="n">Item</span><span class="p">):</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">properties</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">]</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="n">edges</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>

<span class="k">class</span> <span class="nc">MyPlugin</span><span class="p">(</span><span class="n">PluginBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;&quot;&quot;&quot;</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="n">PluginBase</span><span class="o">.</span><span class="n">properties</span>
    <span class="n">edges</span><span class="o">=</span> <span class="n">PluginBase</span><span class="o">.</span><span class="n">edges</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;running&quot;</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">MyItem</span><span class="p">(</span><span class="s2">&quot;some person&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">add_to_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="n">client</span><span class="o">.</span><span class="n">add_to_schema</span><span class="p">(</span><span class="n">MyItem</span><span class="p">(</span><span class="s2">&quot;my name&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Memri plugins need to define at least 2 methods: <code>.run()</code> and <code>.add_to_schema()</code>. <code>.run()</code> defines the logic of the plugin. <code>.add_to_schema()</code> defines the schema for the plugin in the pod. Note that currently, <code>add_to_schema</code> requires all item to <strong>have all properties defined that are used in the plugin</strong>. In the future, we might replace add_to_schema, to be done automatically, based on a declarative schema defined in the plugin.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Running-your-plugin-using-the-CLI">Running your plugin using the CLI<a class="anchor-link" href="#Running-your-plugin-using-the-CLI"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Plugins can be started using the pymemri <a href="/pymemri/plugin.pluginbase.html#run_plugin"><code>run_plugin</code></a> or <a href="/pymemri/plugin.pluginbase.html#run_plugin_from_pod"><code>run_plugin_from_pod</code></a> CLI. With <a href="/pymemri/plugin.pluginbase.html#run_plugin"><code>run_plugin</code></a> the plugin is invoked directly by spawning a new python process, while <a href="/pymemri/plugin.pluginbase.html#run_plugin_from_pod"><code>run_plugin_from_pod</code></a> requests the pod to spawn a new process, docker container, or kubernetes container, which in calls <a href="/pymemri/plugin.pluginbase.html#run_plugin"><code>run_plugin</code></a> (for more info see <a href="/pymemri/plugin.pluginbase.html#run_plugin_from_pod"><code>run_plugin_from_pod</code></a>. When using <a href="/pymemri/plugin.pluginbase.html#run_plugin"><code>run_plugin</code></a>, you can either pass your run arguments as parameters, or set them as environment variables. If both are set, the CLI will use the passed arguments.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_plugin" class="doc_header"><code>run_plugin</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/plugin/pluginbase.py#L170" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_plugin</code>(<strong><code>pod_full_address</code></strong>:<code>Param object at 0x7fcde15ae340&gt;</code>=<em><code>None</code></em>, <strong><code>plugin_run_id</code></strong>:<code>Param object at 0x7fcde15ae370&gt;</code>=<em><code>None</code></em>, <strong><code>database_key</code></strong>:<code>Param object at 0x7fcde15ae3a0&gt;</code>=<em><code>None</code></em>, <strong><code>owner_key</code></strong>:<code>Param object at 0x7fcde15ae3d0&gt;</code>=<em><code>None</code></em>, <strong><code>container</code></strong>:<code>Param object at 0x7fcde15ae400&gt;</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To start a plugin on your local machine, you can use the CLI. This will create a client for you, and run the code defined in <code>&lt;myplugin&gt;.run()</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">PodClient</span><span class="p">()</span>
<span class="n">run</span> <span class="o">=</span> <span class="n">PluginRun</span><span class="p">(</span><span class="n">containerImage</span><span class="o">=</span><span class="s2">&quot;pymemri&quot;</span><span class="p">,</span> <span class="n">pluginModule</span><span class="o">=</span><span class="s2">&quot;pymemri.plugin.pluginbase&quot;</span><span class="p">,</span>
                <span class="n">pluginName</span><span class="o">=</span><span class="s2">&quot;MyPlugin&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s2">&quot;not started&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">client</span><span class="o">.</span><span class="n">add_to_schema</span><span class="p">(</span><span class="n">PluginRun</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="ow">and</span> <span class="n">client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>run_plugin --pod_full_address<span class="o">=</span><span class="nv">$DEFAULT_POD_ADDRESS</span> --owner_key<span class="o">=</span><span class="nv">$client</span>.owner_key <span class="err">\</span>
            <span class="o">--</span><span class="n">database_key</span><span class="o">=</span><span class="err">$</span><span class="n">client</span><span class="o">.</span><span class="n">database_key</span> <span class="o">--</span><span class="n">container</span><span class="o">=</span><span class="s2">&quot;pymemri&quot;</span> <span class="o">--</span><span class="n">plugin_run_id</span><span class="o">=</span><span class="err">$</span><span class="n">run</span><span class="o">.</span><span class="n">id</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Used arguments passed to `run_plugin()` (ignoring environment)
pod_full_address=http://localhost:3030
plugin_run_id=1bf06Bfb7B63f114FcfB8DBC67eA49Be
owner_key=3961574559904730128514448689870083724159258570216156665995117538
auth_json=None

running
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='The data that is created here should be in the pod in order for this to work' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Run-from-pod">Run from pod<a class="anchor-link" href="#Run-from-pod"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In production, we start plugins by making an API call to the pod, which in turn creates an environment for the plugin and starts it using docker containers, kubernetes containers or a shell script. We can start this process using the <a href="/pymemri/plugin.pluginbase.html#run_plugin_from_pod"><code>run_plugin_from_pod</code></a> CLI. <strong>Note that when using docker, provided container name should be "installed" within the Pod environemnt (e.g. <code>docker build -t pymemri .</code> for this repo) in order to start it.</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/pymemri/images/running_a_plugin.svg" alt="running a plugin"></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_plugin_from_pod" class="doc_header"><code>run_plugin_from_pod</code><a href="https://gitlab.memri.io/memri/pymemri/tree/prod/pymemri/plugin/pluginbase.py#L202" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_plugin_from_pod</code>(<strong><code>pod_full_address</code></strong>:"The pod full address"=<em><code>None</code></em>, <strong><code>database_key</code></strong>:"Database key of the pod"=<em><code>None</code></em>, <strong><code>owner_key</code></strong>:"Owner key of the pod"=<em><code>None</code></em>, <strong><code>container</code></strong>:"Pod container to run frod"=<em><code>None</code></em>, <strong><code>plugin_module</code></strong>:"Plugin module"=<em><code>None</code></em>, <strong><code>plugin_name</code></strong>:"Plugin class name"=<em><code>None</code></em>, <strong><code>settings_file</code></strong>:"Plugin settings (json)"=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">PodClient</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>run_plugin_from_pod --pod_full_address<span class="o">=</span><span class="nv">$DEFAULT_POD_ADDRESS</span> --owner_key<span class="o">=</span><span class="nv">$client</span>.owner_key <span class="err">\</span>
                     <span class="o">--</span><span class="n">database_key</span><span class="o">=</span><span class="err">$</span><span class="n">client</span><span class="o">.</span><span class="n">database_key</span> <span class="o">--</span><span class="n">container</span><span class="o">=</span><span class="s2">&quot;pymemri&quot;</span> \
                     <span class="o">--</span><span class="n">plugin_module</span><span class="o">=</span><span class="s2">&quot;pymemri.plugin.pluginbase&quot;</span> <span class="o">--</span><span class="n">plugin_name</span><span class="o">=</span><span class="s2">&quot;MyPlugin&quot;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>pod_full_address=http://localhost:3030
owner_key=4566065835753341432440539540364977361089552669232085362436171995

calling the `create` api on http://localhost:3030 to make your Pod start a plugin with id cc01FaEbAf5DC88ADc27e408a790b8D6.
*Check the pod log/console for debug output.*
Created PluginRun: cc01FaEbAf5DC88ADc27e408a790b8D6
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

